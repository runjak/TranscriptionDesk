!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof module&&"object"==typeof module.exports?module.exports=a(require("jquery")):a(jQuery)}(function(a){"use strict";a.keyboard=a.keyboard||{},a.fn.addScramble=function(b){var c,d={targetKeys:/[a-z\d]/i,byRow:!0,byKeySet:!1,randomizeOnce:!0,sameForAll:!1,init:null};return this.each(function(){var e,f=a(this).data("keyboard"),g=f.namespace+"Scramble",h=f.options;f&&!f.scramble_options&&(e=f.scramble_options=a.extend({},d,b),f.extensionNamespace.push(g),e.orig_create=h.create,f.scramble_setup=function(b){var c,d,g,h,i,j,k,l,m,n,o;if(c=b.find("."+a.keyboard.css.keySet),b.length){for(e.byKeySet&&(c=c.eq(0)),d=0;d<c.length;d++)if(g=c.eq(d),k=0,o=[],m=[],l=[],n=[],g.children("button, span, br").each(function(){"BR"===this.tagName?e.byRow?(o.push(this),m.push(!1),n[k]=o,l[k]=m,o=[],m=[],k++):(n[k]=this,l[k]=!1,k++):(j=a(this).attr("data-value")||"",j=1===j.length&&e.targetKeys.test(j)?j:!1,e.byRow?(o.push(this),m.push(j)):(n[k]=this,l[k]=j,k++))}),g.find("."+a.keyboard.css.endRow).remove(),e.byRow)for(i=0;i<n.length;i++)for(o=f.shuffle(n[i],l[i]),h=0;h<o.length;h++)g.append(o[h]);else for(o=f.shuffle(n,l),h=0;h<o.length;h++)g.append(o[h]);return e.byKeySet&&(b=f.realign(b)),b}},f.shuffle=function(a,b){for(var c,d,e=a.length;e>0;)d=Math.floor(Math.random()*e),b[e-1]===!1&&e--,b[e-1]!==!1&&b[d]!==!1&&(e--,c=a[e],a[e]=a[d],a[d]=c);return a},f.realign=function(b){var c,d,e,f=b.find("."+a.keyboard.css.keySet),g=f.eq(0);return f=f.filter(":gt(0)"),g.children().each(function(b,g){d="BR"===g.tagName,e=a(g).attr("data-pos"),f.each(function(b,f){c=d?"br:first":'button[data-pos="'+e+'"]',a(f).find(c).appendTo(f)})}),b},h.create=function(){var b=h.layout;a.keyboard.builtLayouts[b]={mappedKeys:{},acceptedKeys:[],$keyboard:null},"undefined"==typeof a.keyboard.builtLayouts[f.orig_layout]&&(f.layout=h.layout=f.orig_layout,f.buildKeyboard(f.layout,!0),f.layout=h.layout=b),a.keyboard.builtLayouts[b]=a.extend(!0,{},a.keyboard.builtLayouts[f.orig_layout]),e.randomizeOnce&&(a.keyboard.builtLayouts[b].$keyboard=f.scramble_setup(a.keyboard.builtLayouts[f.orig_layout].$keyboard.clone())),f.$keyboard=a.keyboard.builtLayouts[b].$keyboard,e.randomizeOnce||f.$el.unbind(a.keyboard.events.kbBeforeVisible+g).bind(a.keyboard.events.kbBeforeVisible+g,function(a,b){b.$keyboard=b.scramble_setup(b.$keyboard)}),a.isFunction(e.orig_create)&&e.orig_create(f)},/^scrambled/.test(h.layout)||(f.orig_layout=h.layout,c=c||"scrambled"+Math.round(1e4*Math.random()),h.layout=e.sameForAll?c:"scrambled"+Math.round(1e4*Math.random())),h.alwaysOpen&&f.$keyboard.length?setTimeout(function(){f.$keyboard=f.scramble_setup(f.$keyboard),a.isFunction(e.init)&&e.init(f)},0):a.isFunction(e.init)&&e.init(f))})}});